sap.ui.define(["sap/ui/core/UIComponent","sap/ui/Device","wasteManagement/workflowuimodule/model/models"],function(t,e,s){"use strict";return t.extend("wasteManagement.workflowuimodule.Component",{metadata:{manifest:"json"},init:function(){t.prototype.init.apply(this,arguments);this.getRouter().initialize();this.setModel(s.createDeviceModel(),"device");this.setTaskModels();this.getInboxAPI().addAction({action:"APPROVE",label:"Approve",type:"accept"},function(){this.completeTask(true)},this);this.getInboxAPI().addAction({action:"REJECT",label:"Reject",type:"reject"},function(){this.completeTask(false)},this)},setTaskModels:function(){var t=this.getComponentData().startupParameters;this.setModel(t.taskModel,"task");var e=new sap.ui.model.json.JSONModel(this._getTaskInstancesBaseURL()+"/context");this.setModel(e,"context")},_getTaskInstancesBaseURL:function(){return this._getWorkflowRuntimeBaseURL()+"/task-instances/"+this.getTaskInstanceID()},_getWorkflowRuntimeBaseURL:function(){var t=this.getManifestEntry("/sap.app/id");var e=t.replaceAll(".","/");var s=jQuery.sap.getModulePath(e);return s+"/bpmworkflowruntime/v1"},getTaskInstanceID:function(){return this.getModel("task").getData().InstanceID},getInboxAPI:function(){var t=this.getComponentData().startupParameters;return t.inboxAPI},completeTask:function(t){this.getModel("context").setProperty("/approved",t);this._patchTaskInstance();this._refreshTaskList()},_patchTaskInstance:function(){var t={status:"COMPLETED",context:this.getModel("context").getData()};jQuery.ajax({url:this._getTaskInstancesBaseURL(),method:"PATCH",contentType:"application/json",async:false,data:JSON.stringify(t),headers:{"X-CSRF-Token":this._fetchToken()}})},_fetchToken:function(){var t;jQuery.ajax({url:this._getWorkflowRuntimeBaseURL()+"/xsrf-token",method:"GET",async:false,headers:{"X-CSRF-Token":"Fetch"},success(e,s,a){t=a.getResponseHeader("X-CSRF-Token")}});return t},_refreshTaskList:function(){this.getInboxAPI().updateTask("NA",this.getTaskInstanceID())}})});